___
# 单线程？
主线程，用来做命令处理，增删查改

所谓的单线程，主要是指命令处理是单线程完成

实际上 redis 进程绝对不是只有一个线程

___
# bio 线程
b 是 background 的意思

## bio_close_file
关闭文件，比如 RBD 文件
close(fd) 是一个阻塞操作，关闭大文件就更阻塞，所以由一个线程去完成

## bio_aof_fsync
RBD 是 fork 一个子进程刷盘
AOF 是在主线程刷盘，可以配置可以实现异步刷盘

## bio_lazy_free
扩容，释放内存 free 也是个阻塞操作，也可以通过新建线程异步实现

___
# IO 线程
实现与 redis 交互的协议
读 read
写 write
解码
编码
加密
解密

___
# 为什么不用多线程实现
是内存操作。。不是 CPU 密集型，也不是 IO 密集型。
数据类型多，多线程，加锁复杂，粒度不好控制。
加锁， CPU 时间片切换，上下文切换，抵消多线程优点。

___
# 单线程缺点
不能有耗时操作
如 KEYS 命令

___
# 单线程为什么这么快？
内存操作
数据结构高效
reactor 网络模型，IO 多路复用，非阻塞 IO
耗时、阻塞操作开启线程处理
对象类型有多种实现
阻塞大操作，拆分成小的非阻塞操作
