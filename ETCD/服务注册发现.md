## 服务注册
服务器连接到 etcd 时申请一个租约（Lease），etcd 通过该租约对服务器进行检测，实现对服务器的动态管理。

在注册时，会初始化一个心跳周期 ttl 与租约周期 lease。服务器需要在心跳周期之内向 etcd 发送数据包，表示自己能够正常工作。如果在规定的心跳周期内，etcd 没有收到心跳包，则表示该服务器异常，etcd 会将该服务器对应的信息进行删除。如果心跳包正常，但是服务器的租约周期结束，则需要重新申请新的租约，如果不申请，则 etcd 会删除对应租约的所有信息。

## 服务发现
客户端启动的时候会从 etcd 中获取到服务器的基本信息，将这些信息存储在本地 map 中，在后续通过本地信息与服务器进行连接。

## 服务通知
客户端请求的时候，etcd 会创建一个 Watcher，实时监测客户端请求的服务器信息是否发生变化，如果产生变化则通知客户端。
etcd 会保存每个客户端发来的 watcher 请求，watcher监听一个或一组key，如果有变更，watcher将变更内容通过chan 发送出去。watcherGroup 管理多个 watcher，能够根据 key 快速找到监听该key的一个或多个 watcher。etcd 会有一个线程持续不断地遍历所有的 watch 请求，每个 watch 对象都会负责维护其监控的 key 事件，看其推送到了哪个 revision。

在 etcd 中，使用 Raft 算法实现数据统一；使用租约（Lease）实现对服务器的动态检测；使用监测 (Watch) 实现对服务器变更的通知。结合上述三点 etcd 实现服务发现