___
# HTTPS（HTTP+SSL/TLS）
https 是在 http 的基础之上附加了新的协议通过对传输过程数据进行加密进而实现数据的安全性。

就是 HTTP 穿上了 SSL/TLS 的外套，我们都知道 HTTP 属于应用层的协议，而 SSL（安全套接字）与 TLS （运输层安全）都属于运输层协议。其实SSL与TLS都是上个世纪的产物，最新版本的TLS建立在SSL 3.0协议规范之上

___
# 明文
HTTP协议是明文传输的，明文就是未被加密过的原始数据。

___
# 加密

## 对称加密算法（私钥加密）
有AES、DES、3DES、TDEA、Blowfish、RC4、RC5、IDEA等。加密使用的密钥和解密使用的密钥是同一个密钥。由于加密算法是公开的，若要保证安全性，密钥不能对外公开。通常用来加密消息体。

## 非对称加密算法（公钥加密）
有RSA、DSA/DSS、Elgamal、Rabin、D-H、ECC等。在客户端与服务器相互验证的过程中用的就是非对称加密算法
RSA密码体制就是公钥密码体制，RSA的一对公钥和私钥都可以用来加密和解密。
比如**公钥加密后只能由私钥解密；反之亦然，私钥加密后只能由公钥解密**。且一方加密的内容只能由对方进行解密。

___
# 证书
相比较 HTTP ，HTTPS 还多了证书认证的过程

凡是访问https的请求必须进行证书认证，当浏览器申请到一个https的域名时，会得到一个数据证书，这份数据证书中含有一份用于RAS的加密公钥，当用户获取到证书后可以使用公钥对自己自身生成的密钥进行一次加密，并将加密后的结果发送给服务器，服务器通过私钥进行解密，得到用户的密钥，这份密钥在整个传输中都保持安全状态，不会被他人读取，此后浏览器和服务器之间的数据发送可以使用此密钥进行加密，保证了数据的安全传输。

# 证书认证机构（CA）
数字证书认证机构（英语：Certificate Authority，缩写为CA），也称为电子商务认证中心、电子商务认证授权机构，是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。

其实任何个体/组织都可以成为 CA（自签证书），但是你发发布的证书客户端是不信任的，也是就前文提及的需要权威。比如 Symantec、Comodo、Godaddy、Digicert 这些权威机构

客户端信任这些 CA，就会在其本地保持这些CA的 根证书（root certificate），根证书是CA自己的证书，是证书验证链的开头。根证书没有机构（已经是权威了）再为其做数字签名，所以都是自签证书。

CA会通过 中介证书（intermediate-certificate） 替代根证书的去做服务器端的证书签名，确保根证书密钥绝对不可访问。也就是说 CA 也拥有一个证书，内含公钥和私钥。网上的公众用户通过验证CA的签字从而信任 CA ，任何人都可以得到CA的证书（含公钥），用以验证它所签发的证书。

___
# 通信流程

HTTPS通信主要包括几个节点，发起请求、验证身份、协商秘钥、加密会话，具体流程如下（此例子只有客户端对服务端的单向验证）：

1）客户端向服务端发起建立HTTPS请求。
告诉服务端自己支持哪些对称加密算法和哈希算法

2）服务器向客户端发送数字证书。
从客户端支持的加密算法中选择一种双方都支持的加密算法（此算法用于后面的会话密钥生成）和哈希算法
向 CA 申请证书[[#申请证书过程]]
服务端生成把证书、会话密钥生成算法，一同发给客户端

3）客户端验证数字证书
客户端收到服务器的响应后会先验证证书的合法性（证书中包含的地址与正在访问的地址是否一致，证书是否过期
[[#证书验证过程]]

4）客户端生成会话密钥
证书验证通过后客户端用第二步的确定好的会话密钥生成算法，生成会话密钥 R ，并用服务器公钥加密会话秘钥 R 

5）服务端解密秘钥
服务端收到自己公钥加密的会话秘钥 R 后用自己的私钥解密，得到会话秘钥 R
自此，服务端和客户端都掌握了会话秘钥 R ，而不存在第三方知道这个会话秘钥，后续的所有通信都通过会话秘钥 R 加解密，保证了通信的安全

6）客户端与服务端开始进行加密会话

## 申请证书过程
服务器通过非对称加密算法（RSA） 生成一对公钥和密钥，然后把需要的申请信息（国家，域名等）连同公钥发送给证书认证机构（CA）

CA构确认无误后通过消息摘要算法（MD5，SHA) 生成整个申请信息的摘要签名M，然后把签名M和使用的摘要算法用 CA 自己的私钥进行加密
证书包含了：
公钥
证书拥有者身份信息
数字证书认证机构（发行者）信息
发行者对这份文件的数字签名及使用的算法
有效期

# 证书验证过程
a.  首先浏览器会从内置的证书列表中索引，找到服务器下发证书对应的机构，如果没有找到，此时就会提示用户该证书是不是由权威机构颁发，是不可信任的。如果查到了对应的机构，则取出该机构颁发的公钥。
b.  用机构的证书公钥解密得到证书的内容和证书签名，内容包括网站的网址、网站的公钥、证书的有效期等。浏览器会先验证证书签名的合法性，通过相同的摘要算法，对解密得到的证书信息进行摘要 M1，和解密得到的证书签名 M2 对比，如果一样则验证通过。
c. 签名通过后，浏览器验证证书记录的网址是否和当前网址是一致的，不一致会提示用户。如果网址一致会检查证书有效期，证书过期了也会提示用户。这些都通过认证时，浏览器就可以信任服务端，安全使用证书中的服务端公钥了。




